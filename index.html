<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards MMS - Img</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4ade80',
                        'primary-dark': '#22c55e',
                        secondary: '#f6f9fc',
                        dark: '#171717',
                        light: '#ffffff',
                        gray: {
                            100: '#f8f9fa',
                            200: '#e9ecef',
                            300: '#dee2e6',
                            400: '#ced4da',
                            500: '#adb5bd',
                            600: '#058E3F',
                            700: '#04773B',
                            800: '#1f2937',
                            900: '#171717',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 2px 4px rgba(0,0,0,.04), 0 8px 16px rgba(0,0,0,.08)',
                        'button': '0 4px 6px rgba(50,50,93,.11), 0 1px 3px rgba(0,0,0,.08)',
                        'button-hover': '0 7px 14px rgba(50,50,93,.1), 0 3px 6px rgba(0,0,0,.08)',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .drag-over {
            background-color: rgba(74, 222, 128, 0.08);
            border-color: #4ade80 !important;
        }
        
        #toast {
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .password-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(23, 23, 23, 0.96);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .password-box {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-20px);
            opacity: 0;
            animation: slideUp 0.4s ease-out forwards;
        }
        
        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .remember-me input {
            margin-right: 0.5rem;
        }

        .upload-item {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 1rem;
            align-items: center;
        }

        .upload-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Password Protection -->
    <div id="password-protection" class="password-container">
        <div class="password-box">
            <div class="text-center mb-6">
                <div class="flex justify-center mb-4">
                    <img src="assets/logo_black.png" alt="Cards Logo" class="h-14">
                </div>
                <h2 class="text-2xl font-bold text-dark mb-1">Cards MMS - Img</h2>
                <p class="text-gray-600">Enter credentials to continue</p>
            </div>
            
            <form id="password-form" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
                
                <div class="remember-me">
                    <input type="checkbox" id="remember-me" name="remember-me">
                    <label for="remember-me" class="text-sm text-gray-700">Remember me</label>
                </div>
                
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Continue
                </button>
            </form>
            
            <div class="mt-6 text-center text-xs text-gray-500">
                Unauthorized use is unlawful and prohibited
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until authenticated) -->
    <div id="main-content" class="hidden main-content">
        <!-- Modern Header -->
        <header class="bg-dark text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <img src="assets/logo.png" alt="Cards Logo" class="h-10">
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="submit-ticket-btn" class="bg-primary hover:bg-primary-dark px-3 py-1.5 rounded-md text-sm font-medium transition-colors">
                            <i class="fas fa-ticket-alt mr-1"></i> Submit Ticket
                        </button>
                        <button id="uploads-btn" class="bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-md text-sm font-medium transition-colors">
                            <i class="fas fa-images mr-1"></i> Uploads
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-4xl mx-auto px-4 py-12 flex-grow">
            <!-- Upload Section Header -->
            <div class="mb-10 text-center">
                <h1 class="text-4xl font-bold text-dark mb-2">Image Upload</h1>
                <p class="text-gray-600 max-w-lg mx-auto">Secure image hosting for Cards MMS. Images are stored in <span class="font-mono text-sm bg-gray-100 px-2 py-1 rounded">nicholasxdavis/cards-img</span></p>
                <div class="mt-4 text-xs text-gray-500">
                    Unauthorized use is unlawful and prohibited
                </div>
            </div>

            <!-- Upload Box -->
            <div id="upload-box" class="bg-white rounded-xl shadow-card border border-gray-100 p-6 mb-8">
                <div id="drop-zone" class="border-2 border-dashed border-gray-200 rounded-lg p-12 text-center cursor-pointer hover:border-primary transition-colors">
                    <input type="file" id="file-input" class="hidden" accept="image/*" multiple>
                    <div class="mx-auto h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-cloud-upload-alt text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-dark mb-1">Drag & drop images</h3>
                    <p class="text-gray-600 mb-4">or click to browse files</p>
                    <div class="inline-flex items-center px-4 py-2 border border-gray-200 rounded-full text-sm font-medium text-gray-700 bg-gray-50">
                        <i class="fas fa-folder-open mr-2 text-gray-500"></i>
                        Select files
                    </div>
                </div>
            </div>

            <!-- View More Section -->
            <div class="bg-white rounded-xl shadow-card border border-gray-100 p-6 mb-8 text-center">
                <h3 class="text-lg font-medium text-dark mb-2">Learn More About Cards</h3>
                <p class="text-gray-600 mb-4">Discover all the features and capabilities of Cards MMS</p>
                <a href="https://cards.example.com" target="_blank" class="inline-flex items-center px-4 py-2 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg shadow-button hover:shadow-button-hover transition-all">
                    <i class="fas fa-external-link-alt mr-2"></i>
                    Visit Cards Website
                </a>
            </div>

            <!-- Results -->
            <div id="results" class="hidden bg-white rounded-xl shadow-card border border-gray-100 overflow-hidden">
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <div class="flex items-center justify-between">
                        <h2 class="font-medium text-gray-800">Uploaded Images</h2>
                        <span id="file-count" class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full">0 files</span>
                    </div>
                </div>
                <div id="results-list" class="divide-y divide-gray-100"></div>
                <div class="p-4 bg-gray-50 border-t border-gray-100">
                    <button id="copy-all" class="w-full flex items-center justify-center py-2.5 px-4 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg shadow-button hover:shadow-button-hover transition-all">
                        <i class="fas fa-copy mr-2"></i>
                        Copy All Links
                    </button>
                </div>
            </div>
        </div>

        <!-- Submit Ticket Modal -->
        <div id="ticket-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-dark">Submit a Ticket</h3>
                    <button id="close-ticket-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="ticket-form" class="space-y-4">
                    <div>
                        <label for="ticket-subject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                        <input type="text" id="ticket-subject" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="ticket-message" class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                        <textarea id="ticket-message" rows="4" required
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                    </div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Submit Ticket
                    </button>
                </form>
            </div>
        </div>

        <!-- Uploads History Modal -->
        <div id="uploads-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-dark">Your Upload History</h3>
                    <button id="close-uploads-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="uploads-list" class="space-y-4 max-h-[70vh] overflow-y-auto">
                    <!-- Upload history items will be added here -->
                </div>
                <div class="mt-4 text-right">
                    <button id="clear-uploads" class="text-sm text-red-500 hover:text-red-700">
                        Clear History
                    </button>
                </div>
            </div>
        </div>

        <!-- Modern Footer -->
        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="md:flex md:items-center md:justify-between">
                    <div class="flex justify-center md:order-2 space-x-6">
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                    <div class="mt-8 md:mt-0 md:order-1">
                        <p class="text-center text-xs text-gray-500">
                            &copy; 2025 Cards MMS. All rights reserved.
                            <span class="block md:inline mt-1 md:mt-0">Unauthorized use is unlawful and prohibited.</span>
                        </p>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Toast -->
        <div id="toast" class="fixed bottom-6 right-6 hidden bg-dark text-white text-sm px-4 py-3 rounded-lg shadow-lg flex items-start">
            <i class="fas fa-check-circle mt-0.5 mr-2 text-green-400"></i>
            <span id="toast-msg"></span>
        </div>
    </div>

    <script>
        // Password Protection
        const passwordProtection = document.getElementById('password-protection');
        const mainContent = document.getElementById('main-content');
        const passwordForm = document.getElementById('password-form');
        const rememberMe = document.getElementById('remember-me');
        
        // Check if user is remembered
        if (localStorage.getItem('remembered')) {
            document.getElementById('email').value = localStorage.getItem('rememberedEmail') || '';
            document.getElementById('password').value = localStorage.getItem('rememberedPassword') || '';
            rememberMe.checked = true;
        }
        
        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email === 'chef@farmesilla.com' && password === 'FARM1840!') {
                // Remember user if checkbox is checked
                if (rememberMe.checked) {
                    localStorage.setItem('remembered', 'true');
                    localStorage.setItem('rememberedEmail', email);
                    localStorage.setItem('rememberedPassword', password);
                } else {
                    localStorage.removeItem('remembered');
                    localStorage.removeItem('rememberedEmail');
                    localStorage.removeItem('rememberedPassword');
                }
                
                // Correct credentials
                passwordProtection.style.opacity = '0';
                setTimeout(() => {
                    passwordProtection.style.display = 'none';
                    mainContent.classList.remove('hidden');
                }, 300);
            } else {
                showToast('Incorrect email or password. Please try again.', 'error');
            }
        });

        // Configuration
        const CONFIG = {
            REPO: "nicholasxdavis/cards-img",
            FOLDER: "images/",
            MAX_SIZE: 5 * 1024 * 1024, // 5MB
            // WARNING: Embedding tokens in client-side code is not secure
            // This is for demonstration only - in production, use a server-side solution
            TOKEN: "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" // Replace with your actual token
        };

        // Ticket Modal
        const ticketModal = document.getElementById('ticket-modal');
        const submitTicketBtn = document.getElementById('submit-ticket-btn');
        const closeTicketModal = document.getElementById('close-ticket-modal');
        const ticketForm = document.getElementById('ticket-form');
        
        submitTicketBtn.addEventListener('click', () => {
            ticketModal.style.display = 'flex';
        });
        
        closeTicketModal.addEventListener('click', () => {
            ticketModal.style.display = 'none';
        });
        
        ticketForm.addEventListener('submit', (e) => {
            e.preventDefault();
            showToast('Ticket submitted successfully');
            ticketModal.style.display = 'none';
            ticketForm.reset();
        });
        
        // Uploads History Modal
        const uploadsModal = document.getElementById('uploads-modal');
        const closeUploadsModal = document.getElementById('close-uploads-modal');
        const uploadsList = document.getElementById('uploads-list');
        const clearUploads = document.getElementById('clear-uploads');
        const uploadsBtn = document.getElementById('uploads-btn');
        
        // Function to show upload history
        function showUploadHistory() {
            const uploads = JSON.parse(localStorage.getItem('uploadHistory')) || [];
            uploadsList.innerHTML = '';
            
            if (uploads.length === 0) {
                uploadsList.innerHTML = '<p class="text-gray-500 text-center py-4">No upload history found</p>';
                return;
            }
            
            uploads.forEach((upload, index) => {
                const item = document.createElement('div');
                item.className = 'upload-item bg-gray-50 p-3 rounded-md';
                item.innerHTML = `
                    <img src="${upload.url}" alt="${upload.filename}" class="upload-thumbnail">
                    <div class="upload-details">
                        <p class="text-sm font-medium text-gray-800 truncate mb-2">${upload.filename}</p>
                        <div class="flex items-center">
                            <input value="${upload.url}" class="w-full text-xs text-gray-500 border border-gray-200 rounded px-2 py-1.5 truncate bg-white focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary" readonly>
                            <button class="copy-upload-btn ml-2 px-2 py-1.5 bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-medium rounded transition-colors" data-url="${upload.url}">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                    </div>
                `;
                uploadsList.appendChild(item);
            });
            
            // Add event listeners to copy buttons
            document.querySelectorAll('.copy-upload-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const url = btn.getAttribute('data-url');
                    copyToClipboard(url);
                    showToast('Link copied to clipboard');
                });
            });
        }
        
        closeUploadsModal.addEventListener('click', () => {
            uploadsModal.style.display = 'none';
        });
        
        clearUploads.addEventListener('click', () => {
            localStorage.removeItem('uploadHistory');
            showUploadHistory();
            showToast('Upload history cleared');
        });

        // Add click event to Uploads button
        uploadsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            uploadsModal.style.display = 'flex';
            showUploadHistory();
        });

        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const uploadBox = document.getElementById('upload-box');
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const resultsDiv = document.getElementById('results');
            const resultsList = document.getElementById('results-list');
            const copyAllBtn = document.getElementById('copy-all');
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-msg');
            const fileCount = document.getElementById('file-count');

            // Upload Handlers
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                dropZone.addEventListener(event, (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropZone.classList.toggle('drag-over', 
                        event === 'dragenter' || event === 'dragover');
                });
            });

            dropZone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files));
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', () => handleFiles(fileInput.files));

            // Core Functions
            async function handleFiles(files) {
                if (!files.length) return;
                
                resultsList.innerHTML = '';
                resultsDiv.classList.remove('hidden');
                
                let successCount = 0;
                
                for (const file of files) {
                    if (!file.type.startsWith('image/')) {
                        showToast(`Skipped non-image: ${file.name}`, 'error');
                        continue;
                    }
                    
                    if (file.size > CONFIG.MAX_SIZE) {
                        showToast(`Too large (max 5MB): ${file.name}`, 'error');
                        continue;
                    }

                    try {
                        const url = await uploadToGitHub(file);
                        addResultItem(file.name, url);
                        successCount++;
                        updateFileCount(successCount);
                        
                        // Save to upload history
                        saveToUploadHistory(file.name, url);
                    } catch (error) {
                        console.error(error);
                        showToast(`Failed to upload: ${file.name}`, 'error');
                    }
                }
                
                if (successCount > 0) {
                    showToast(`Uploaded ${successCount} file${successCount > 1 ? 's' : ''} successfully`);
                }
            }

            function saveToUploadHistory(filename, url) {
                let uploads = JSON.parse(localStorage.getItem('uploadHistory')) || [];
                uploads.unshift({ filename, url, timestamp: new Date().toISOString() });
                
                // Keep only the last 50 uploads
                if (uploads.length > 50) {
                    uploads = uploads.slice(0, 50);
                }
                
                localStorage.setItem('uploadHistory', JSON.stringify(uploads));
            }

            async function uploadToGitHub(file) {
                const content = await readAsBase64(file);
                const filename = `${Date.now()}-${file.name.replace(/\s+/g, '-')}`;
                const path = `${CONFIG.FOLDER}${filename}`;
                
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO}/contents/${path}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${CONFIG.TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            message: `Add ${file.name}`,
                            content: content.split(',')[1]
                        })
                    }
                );

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Upload failed');
                }

                const data = await response.json();
                return data.content.download_url
                    .replace('/github.com/', '/raw.githubusercontent.com/')
                    .replace('/master/', '/main/');
            }

            // Helper Functions
            function readAsBase64(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            function addResultItem(filename, url) {
                const item = document.createElement('div');
                item.className = 'p-4 flex items-center justify-between hover:bg-gray-50 transition-colors';
                item.innerHTML = `
                    <div class="flex items-center min-w-0">
                        <div class="flex-shrink-0 h-10 w-10 bg-gray-100 rounded-md flex items-center justify-center mr-3">
                            <i class="fas fa-image text-gray-400"></i>
                        </div>
                        <div class="min-w-0">
                            <p class="text-sm font-medium text-dark truncate">${filename}</p>
                            <input value="${url}" class="mt-1 w-full text-xs text-gray-500 border border-gray-200 rounded px-2 py-1.5 truncate bg-gray-50 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary" readonly>
                        </div>
                    </div>
                    <button class="copy-btn ml-3 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-medium rounded-md transition-colors">
                        <i class="far fa-copy mr-1"></i> Copy
                    </button>
                `;
                
                item.querySelector('.copy-btn').addEventListener('click', () => {
                    copyToClipboard(url);
                    showToast('Link copied to clipboard');
                });
                
                resultsList.appendChild(item);
            }

            function updateFileCount(count) {
                fileCount.textContent = `${count} file${count !== 1 ? 's' : ''}`;
            }

            copyAllBtn.addEventListener('click', () => {
                const urls = Array.from(resultsList.querySelectorAll('input'))
                    .map(input => input.value)
                    .join('\n');
                
                if (urls) {
                    copyToClipboard(urls);
                    showToast('All links copied to clipboard');
                } else {
                    showToast('No links to copy', 'error');
                }
            });

            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });
            }

            function showToast(message, type = 'success') {
                toastMsg.textContent = message;
                
                // Update icon based on type
                const icon = toast.querySelector('i');
                if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle mt-0.5 mr-2 text-red-400';
                } else {
                    icon.className = 'fas fa-check-circle mt-0.5 mr-2 text-green-400';
                }
                
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.add('hidden'), 3000);
            }
        });
    </script>
</body>
</html>